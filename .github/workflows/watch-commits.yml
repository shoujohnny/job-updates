name: Watch Summer Internship Repos

on:
  schedule:
    - cron: '*/5 * * * *'  # every 5 minutes
  workflow_dispatch:

jobs:
  check-commits:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout this repo
        uses: actions/checkout@v2

      - name: Check latest commits and notify Discord
        run: |
          #!/bin/bash

          repos=(
            "SimplifyJobs/Summer2025-Internships"
            "vanshb03/Summer2026-Internships"
          )

          for repo in "${repos[@]}"; do
            echo "Checking $repo"
            latest_commit=$(curl -s https://api.github.com/repos/$repo/commits | jq -r '.[0].sha')
            state_file=".${repo//\//_}.txt"

            if [[ -f $state_file ]]; then
              prev_commit=$(cat $state_file)
              if [[ "$latest_commit" != "$prev_commit" ]]; then
                echo "New commit detected for $repo"
                curl -H "Content-Type: application/json" -X POST \
                -d "{\"content\": \"ðŸ“Œ New commit to **$repo**: https://github.com/$repo/commit/$latest_commit\"}" \
                ${{ secrets.DISCORD_WEBHOOK_URL }}
              fi
            else
              echo "First time tracking $repo"
            fi

            echo "$latest_commit" > $state_file
          done

      - name: Commit updated state files
        run: |
          git config user.name "GitHub Action"
          git config user.email "action@github.com"
          git add .
          git commit -m "Update latest commit state" || echo "No changes"
          git push
